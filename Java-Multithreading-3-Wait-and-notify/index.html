<!DOCTYPE html>
<html lang="en">







<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="preconnect" href="//www.googletagmanager.com">
	<link rel="preconnect" href="//zz.bdstatic.com">
	<link rel="preconnect" href="//sp0.baidu.com">
	<link rel="preconnect" href="//www.google-analytics.com">
	<link rel="preconnect" href="//cdn1.lncld.net">
	<link rel="preconnect" href="//unpkg.com">
	<link rel="preconnect" href="//app-router.leancloud.cn">
	<link rel="preconnect" href="//9qpuwspm.api.lncld.net">
	<link rel="preconnect" href="//gravatar.loli.net">

	<title>Java Multithreading 3: Wait and notify | Nick Li</title>

	<meta name="HandheldFriendly" content="True">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
	<meta name="generator" content="hexo">
	<meta name="author" content="Nick Li">
	<meta name="description" content>

	

	

	
	<meta name="theme-color" content="#3c484e">
	<meta name="msapplication-TileColor" content="#3c484e">
	

	

	

	<meta property="og:site_name" content="Nick Li">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Java Multithreading 3: Wait and notify | Nick Li">
	<meta property="og:description" content>
	<meta property="og:url" content="http://nicklee1006.github.io/Java-Multithreading-3-Wait-and-notify/">

	
	<meta property="article:published_time" content="2020-04-29T10:04:00+08:00"> 
	<meta property="article:author" content="Nick Li">
	<meta property="article:published_first" content="Nick Li, /Java-Multithreading-3-Wait-and-notify/">
	

	
	
	<link rel="stylesheet" href="/css/allinonecss.min.css">

	
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151447201-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'UA-151447201-1');
	</script>
	
	
	
</head>
<body class="post-template">
	<div class="site-wrapper">
		




<header class="site-header post-site-header outer">
    <div class="inner">
        
<nav class="site-nav"> 
    <div class="site-nav-left">
        <ul class="nav">
            <li>
                
                <a href="/" title="Home">HOME</a>
                
            </li>
            
            
            <li>
                <a href="/about" title="ABOUT">ABOUT</a>
            </li>
            
            <li>
                <a href="/archives" title="ARCHIVES">ARCHIVES</a>
            </li>
            
            
        </ul> 
    </div>
    
    <div class="search-button-area">
        <a href="#search" class="search-button">Search ...</a>
    </div>
     
    <div class="site-nav-right">
        
        <a href="#search" class="search-button">Search ...</a>
         
        
<div class="social-links">
    
    
    <a class="social-link" title="github" href="https://github.com/nicklee1006" target="_blank" rel="noopener">
        <svg viewbox="0 0 1049 1024" xmlns="http://www.w3.org/2000/svg"><path d="M524.979332 0C234.676191 0 0 234.676191 0 524.979332c0 232.068678 150.366597 428.501342 358.967656 498.035028 26.075132 5.215026 35.636014-11.299224 35.636014-25.205961 0-12.168395-0.869171-53.888607-0.869171-97.347161-146.020741 31.290159-176.441729-62.580318-176.441729-62.580318-23.467619-60.841976-58.234462-76.487055-58.234463-76.487055-47.804409-32.15933 3.476684-32.15933 3.476685-32.15933 53.019436 3.476684 80.83291 53.888607 80.83291 53.888607 46.935238 79.963739 122.553122 57.365291 152.97411 43.458554 4.345855-33.897672 18.252593-57.365291 33.028501-70.402857-116.468925-12.168395-239.022047-57.365291-239.022047-259.012982 0-57.365291 20.860106-104.300529 53.888607-140.805715-5.215026-13.037566-23.467619-66.926173 5.215027-139.067372 0 0 44.327725-13.906737 144.282399 53.888607 41.720212-11.299224 86.917108-17.383422 131.244833-17.383422s89.524621 6.084198 131.244833 17.383422C756.178839 203.386032 800.506564 217.29277 800.506564 217.29277c28.682646 72.1412 10.430053 126.029806 5.215026 139.067372 33.897672 36.505185 53.888607 83.440424 53.888607 140.805715 0 201.64769-122.553122 245.975415-239.891218 259.012982 19.121764 16.514251 35.636014 47.804409 35.636015 97.347161 0 70.402857-0.869171 126.898978-0.869172 144.282399 0 13.906737 9.560882 30.420988 35.636015 25.205961 208.601059-69.533686 358.967656-265.96635 358.967655-498.035028C1049.958663 234.676191 814.413301 0 524.979332 0z"/></svg>
    </a>
    
    
    
    
    
    
    
    <a class="social-link" title="linkedin" href="https://www.linkedin.com/in/chenzhang-li/" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
    </a>
    
</div>
    </div>
</nav>
    </div>
</header>


<div id="site-main" class="site-main outer" role="main">
    <div class="inner">
        <header class="post-full-header">
            <div class="post-full-meta">
                <time class="post-full-meta-date" datetime="2020-04-29T00:39:57.000Z">
                    2020-04-29
                </time>
                
                <span class="date-divider">/</span>
                
                <a href="/categories/Java/">Java</a>&nbsp;&nbsp;
                
                
            </div>
            <h1 class="post-full-title">Java Multithreading 3: Wait and notify</h1>
        </header>
        <div class="post-full ">
            
            <figure class="post-full-image" style="background-image: url(https://i.loli.net/2020/04/29/L4sFcShKVDoifBt.jpg)">
            </figure>
            
            <div class="post-full-content">
                <article id="photoswipe" class="markdown-body">
                    <p>In this blog I will introduce the thread wait/notify method. Contents include:</p>
<ol>
<li><code>wait()</code>, <code>notify()</code>, <code>notifyAll()</code> and other methods</li>
<li><code>wait()</code> and <code>notify()</code></li>
<li><code>wait(long timeout)</code> and <code>notify()</code></li>
<li><code>wait()</code> and <code>notifyAll()</code></li>
<li>Why <code>notify()</code>, <code>wait()</code> and other functions are defined in <code>Object</code> instead of <code>Thread</code></li>
</ol>
<h2 id="wait-notify-notifyAll-and-other-methods"><a href="#wait-notify-notifyAll-and-other-methods" class="headerlink" title="wait(), notify(), notifyAll() and other methods"></a>wait(), notify(), notifyAll() and other methods</h2><p><code>Object.java</code> defines interfaces such as <code>wait()</code>, <code>notify()</code> and <code>notifyAll()</code>. The role of <code>wait()</code> is to put the current thread into a wait state. At the same time, <code>wait()</code> will let the current thread release the lock it holds. The role of <code>notify()</code> and <code>notifyAll()</code> is to wake up the waiting thread on the current object; <code>notify()</code> will wake up a single thread, and <code>notifyAll()</code> will wake up all threads.</p>
<p>The detailed information about the wait/notify API in the <code>Object</code> class is as follows:</p>
<ul>
<li><strong>notify ()</strong>: wakes up a single thread waiting on this object monitor.</li>
<li><strong>notifyAll()</strong>: wake up all threads waiting on this object monitor.</li>
<li><strong>wait()</strong>: puts the current thread in the <code>blocked state  (wait)</code>, until other threads call this object’s <code>notify()</code> method or <code>notifyAll()</code> method”, the current thread is woken up and enter the <code>runnable</code> state.</li>
<li><strong>wait(long timeout)</strong>: put the current thread in the <code>blocked state  (wait)</code>, until other threads call this object’s <code>notify()</code> method or <code>notifyAll()</code> method, or exceed the specified amount of time, the current thread is woken up and enter the <code>runnable</code> state.</li>
<li><strong>wait(long timeout, int nanos)</strong>: put the current thread in the <code>blocked state  (wait)</code>, until other threads call the <code>notify()</code> method or <code>notifyAll()</code> method of this object, or some other thread interrupts the current thread, or a certain amount of time has been exceeded, the current thread is woken up and enter the <code>runnable</code> state.</li>
</ul>
<h2 id="wait-and-notify-example"><a href="#wait-and-notify-example" class="headerlink" title="wait() and notify() example"></a>wait() and notify() example</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaitAndNotify</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ThreadA t1 = <span class="keyword">new</span> ThreadA(<span class="string">"t1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span>(t1) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Start thread t1</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">" start t1"</span>);</span><br><span class="line">                t1.start();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Main thread waits for t1 to wake up via notify ()</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">" wait()"</span>);</span><br><span class="line">                t1.wait();</span><br><span class="line"></span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">" continue"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" call notify()"</span>);</span><br><span class="line">            <span class="comment">// awake current wait thread</span></span><br><span class="line">            notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Results:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">main start t1</span><br><span class="line">main wait()</span><br><span class="line">t1 call notify()</span><br><span class="line">main continue</span><br></pre></td></tr></table></figure>

<p>The following figure illustrates the flow of “main thread” and “thread t1”.</p>
<img class="post-img b-lazy" data-img="/Java-Multithreading-3-Wait-and-notify/1.png" data-index="0" data-src="/Java-Multithreading-3-Wait-and-notify/1.png">
<br>
<br>

<ul>
<li>Note that “thread t1” stands for <code>Thread t1</code> started in <code>WaitAndNotify</code>. And “lock” stands for synchronization lock of t1.</li>
<li><code>Main thread</code> creates a new <code>thread t1</code> through <code>new ThreadA (&quot;t1&quot;)</code>. Then acquire synchronization lock of t1 through <code>synchronized(t1)</code>. Then call <code>t1.start()</code> to start <code>thread t1</code>.</li>
<li>The <code>main thread</code> executes <code>t1.wait()</code> to release the t1 object’s lock and enters the <code>blocked state  (wait)</code>. Wait for the thread on the <code>t1</code> object to wake it up via <code>notify()</code> or <code>notifyAll()</code>.</li>
<li>After <code>thread t1</code> runs, it acquire lock of current object through <code>synchronized(this)</code>. Then call <code>notify()</code> to wake up “waiting thread on current object”, that is, wake up <code>main thread</code>.</li>
<li>After <code>thread t1</code> is finished, release lock of current object. Immediately after that, the <code>main thread</code> acquires the t1 object’s lock and continues running.</li>
</ul>
<p>For the code above, <code>t1.wait()</code> should let <code>thread t1</code> wait; but why did it let <code>main thread</code> wait?</p>
<p>Let’s look at the comments of <code>wait()</code> in JDK:</p>
<blockquote>
<p>Causes the current thread to wait until it is awakened, typically by being notified or interrupted.</p>
</blockquote>
<p>Note: In the comments, <code>wait()</code> is to let the <strong>current thread</strong> wait, and the <strong>current thread</strong> refers to the thread running on the CPU!</p>
<p>This means that although <code>t1.wait()</code> is the <code>wait()</code> method called through <code>thread t1</code>, the place where <code>t1.wait()</code> is called is in <code>main thread</code>. The <code>main thread</code> must be the current thread, which is in <strong>running</strong> state to execute <code>t1.wait()</code>. Therefore, the current thread at this time is the <code>main thread</code>! Therefore, <code>t1.wait()</code> makes the <code>main thread</code> wait, not <code>thread t1</code>!</p>
<h2 id="wait-long-timeout-and-notify"><a href="#wait-long-timeout-and-notify" class="headerlink" title="wait(long timeout) and notify()"></a>wait(long timeout) and notify()</h2><p><code>wait(long timeout)</code> will make the current thread in the <code>blocked state  (wait)</code>, until other threads call this object’s <code>notify()</code> method or <code>notifyAll()</code> method, or exceed the specified amount of time, the current thread is woken up and enter <code>runnable state</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaitTimeout</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ThreadB t1 = <span class="keyword">new</span> ThreadB(<span class="string">"t1"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span>(t1) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// start Thread t1</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">" start t1"</span>);</span><br><span class="line">                t1.start();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// The main thread waits for t1 to wake up via notify() or notifyAll()</span></span><br><span class="line">                <span class="comment">// or a delay of more than 3000ms; then it is woken up.</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">" call wait "</span>);</span><br><span class="line">                t1.wait(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">" continue"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadB</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadB</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">" run"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// infinite loop</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)</span><br><span class="line">            ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Results:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">main start t1</span><br><span class="line">main call wait </span><br><span class="line">t1 run          // After around 3 seconds...output &quot;main continue&quot;</span><br><span class="line">main continue</span><br></pre></td></tr></table></figure>

<p>The following figure illustrates the flow of “main thread” and “thread t1”.</p>
<img class="post-img b-lazy" data-img="/Java-Multithreading-3-Wait-and-notify/2.png" data-index="1" data-src="/Java-Multithreading-3-Wait-and-notify/2.png">
<br>
<br>

<ul>
<li>The <code>main thread</code> executes <code>t1.start()</code> to start <code>thread t1</code>.</li>
<li>The <code>main thread</code> executes <code>t1.wait(3000)</code>. At this time, the <code>main thread</code> enters the <code>blocked state  (wait)</code>. Need the thread used for t1 object lock to wake it up through <code>notify()</code> or <code>notifyAll()</code> or after a timeout of 3000ms, the <code>main thread</code> enters the <code>runnable state</code> before it can run.</li>
<li>After <code>thread t1</code> runs, it enters an endless loop and runs continuously.</li>
<li>After a timeout of 3000ms, the <code>main thread</code> will enter the <code>runnable state</code>, and then enter the <code>running state</code>.</li>
</ul>
<h2 id="wait-and-notifyAll"><a href="#wait-and-notifyAll" class="headerlink" title="wait() and notifyAll()"></a>wait() and notifyAll()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotifyAll</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object obj = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ThreadC t1 = <span class="keyword">new</span> ThreadC(<span class="string">"t1"</span>);</span><br><span class="line">        ThreadC t2 = <span class="keyword">new</span> ThreadC(<span class="string">"t2"</span>);</span><br><span class="line">        ThreadC t3 = <span class="keyword">new</span> ThreadC(<span class="string">"t3"</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" sleep(3000)"</span>);</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span>(obj) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">" notifyAll()"</span>);</span><br><span class="line">            obj.notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadC</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ThreadC</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">" wait"</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// awake current wait thread</span></span><br><span class="line">                    obj.wait();</span><br><span class="line"></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">" continue"</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Results:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">t1 wait</span><br><span class="line">main sleep(3000)</span><br><span class="line">t3 wait</span><br><span class="line">t2 wait</span><br><span class="line">main notifyAll()</span><br><span class="line">t2 continue</span><br><span class="line">t3 continue</span><br><span class="line">t1 continue</span><br></pre></td></tr></table></figure>

<img class="post-img b-lazy" data-img="/Java-Multithreading-3-Wait-and-notify/3.png" data-index="2" data-src="/Java-Multithreading-3-Wait-and-notify/3.png">
<br>
<br>

<ul>
<li><code>main thread</code> created and started <code>t1</code>, <code>t2</code> and <code>t3</code>.</li>
<li>The <code>main thread</code> sleeps for 3 seconds through <code>sleep(3000)</code>. In the process of <code>main thread</code> sleeping, we assume that the three threads <code>t1</code>, <code>t2</code> and <code>t3</code> are all running. Take <code>t1</code> as an example, when it is running, it will execute <code>obj.wait()</code> to wait for other threads to wake it up via <code>notify()</code> or <code>nofityAll()</code>. The same reason, <code>t2</code> and <code>t3</code> will also wait for other threads to wake them up via <code>nofity()</code> or <code>nofityAll()</code>.</li>
<li>After the <code>main thread</code> sleeps for 3 seconds, it continue runs and execute <code>obj.notifyAll()</code> to wake up the waiting thread on <code>obj</code>, that is, wake up the three threads <code>t1</code>, <code>t2</code> and <code>t3</code>. Immediately after the <code>synchronized(obj)</code> of the <code>main thread</code> is finished, the <code>main thread</code> releases the <code>obj</code> lock. In this way, <code>t1</code>, <code>t2</code> and <code>t3</code> can acquire the <code>obj</code> lock and continue to run!</li>
</ul>
<h2 id="Why-notify-wait-and-other-functions-are-defined-in-Object-instead-of-Thread"><a href="#Why-notify-wait-and-other-functions-are-defined-in-Object-instead-of-Thread" class="headerlink" title="Why notify(), wait() and other functions are defined in Object instead of Thread"></a>Why notify(), wait() and other functions are defined in Object instead of Thread</h2><p>The <code>wait()</code>, <code>notify()</code> and other functions in <code>Object</code>, like <code>synchronized</code>, will operate on “object synchronization lock”.</p>
<p><code>wait()</code> will make the current thread wait, because the thread enters the <code>blocked state  (wait)</code>, so the thread should release the synchronization lock it holds, otherwise other threads cannot obtain the synchronization lock and cannot run!</p>
<p>OK, after the thread calls <code>wait()</code>, it releases the synchronous lock it holds. According to previous introduction, we know that the waiting thread can be woken up by <code>notify()</code> or <code>notifyAll()</code>. Now, think about a question: on what basis does <code>notify()</code> wake up the waiting thread? In other words, what is the relationship between <code>wait()</code> and <code>notify()</code>? The answer is: according to object synchronization lock.</p>
<p>The thread responsible for awakening the waiting thread (we call it “awakening thread”), it is only acquiring the object synchronization lock (the synchronization lock here must be the same as the synchronization lock of the waiting thread), and calling <code>notify()</code> or <code>notifyAll()</code> method, the waiting thread can be woken up. Although, the waiting thread is awakened, it cannot be executed immediately because the awakening thread also holds the object synchronization lock. You must wait for the awakening thread to release the object synchronization lock before the waiting thread can acquire the object synchronization lock and continue to run.</p>
<p>In short, <code>notify()</code>, <code>wait()</code> depends on object synchronization lock, and object synchronization lock is held by an object, and each object has only one lock! This is why <code>notify()</code>, <code>wait()</code> and other functions are defined in the <code>Object</code> class, not the <code>Thread</code> class.</p>

                </article>
                <ul class="tags-postTags">
                    
                    <li>
                        <a href="/tags/Multithreading/" rel="tag"># Multithreading</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>

    
    <nav id="gobottom" class="pagination">
        
        <a class="prev-post" title="Leetcode 148. Sort List" href="/Leetcode-148-Sort-List/">
            ← Leetcode 148. Sort List
        </a>
        
        <span class="prev-next-post">·</span>
        
        <a class="next-post" title="Leetcode 147. Insertion Sort List" href="/Leetcode-147-Insertion-Sort-List/">
            Leetcode 147. Insertion Sort List →
        </a>
        
    </nav>

    
    <div class="inner">
        <div id="comment"></div>
    </div>
    
</div>

<div class="toc-bar">
    <div class="toc-btn-bar">
        <a href="#site-main" class="toc-btn">
            <svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M793.024 710.272a32 32 0 1 0 45.952-44.544l-310.304-320a32 32 0 0 0-46.4 0.48l-297.696 320a32 32 0 0 0 46.848 43.584l274.752-295.328 286.848 295.808z"/></svg>
        </a>
        <div class="toc-btn toc-switch">
            <svg class="toc-open" viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M779.776 480h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M779.776 672h-387.2a32 32 0 0 0 0 64h387.2a32 32 0 0 0 0-64M256 288a32 32 0 1 0 0 64 32 32 0 0 0 0-64M392.576 352h387.2a32 32 0 0 0 0-64h-387.2a32 32 0 0 0 0 64M256 480a32 32 0 1 0 0 64 32 32 0 0 0 0-64M256 672a32 32 0 1 0 0 64 32 32 0 0 0 0-64"/></svg>
            <svg class="toc-close hide" viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M512 960c-247.039484 0-448-200.960516-448-448S264.960516 64 512 64 960 264.960516 960 512 759.039484 960 512 960zM512 128.287273c-211.584464 0-383.712727 172.128262-383.712727 383.712727 0 211.551781 172.128262 383.712727 383.712727 383.712727 211.551781 0 383.712727-172.159226 383.712727-383.712727C895.712727 300.415536 723.551781 128.287273 512 128.287273z"/><path d="M557.05545 513.376159l138.367639-136.864185c12.576374-12.416396 12.672705-32.671738 0.25631-45.248112s-32.704421-12.672705-45.248112-0.25631l-138.560301 137.024163-136.447897-136.864185c-12.512727-12.512727-32.735385-12.576374-45.248112-0.063647-12.512727 12.480043-12.54369 32.735385-0.063647 45.248112l136.255235 136.671523-137.376804 135.904314c-12.576374 12.447359-12.672705 32.671738-0.25631 45.248112 6.271845 6.335493 14.496116 9.504099 22.751351 9.504099 8.12794 0 16.25588-3.103239 22.496761-9.247789l137.567746-136.064292 138.687596 139.136568c6.240882 6.271845 14.432469 9.407768 22.65674 9.407768 8.191587 0 16.352211-3.135923 22.591372-9.34412 12.512727-12.480043 12.54369-32.704421 0.063647-45.248112L557.05545 513.376159z"/></svg>
        </div>
        <a href="#gobottom" class="toc-btn">
            <svg viewbox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M231.424 346.208a32 32 0 0 0-46.848 43.584l297.696 320a32 32 0 0 0 46.4 0.48l310.304-320a32 32 0 1 0-45.952-44.544l-286.848 295.808-274.752-295.36z"/></svg>
        </a>
    </div>
    <div class="toc-main">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#wait-notify-notifyAll-and-other-methods"><span class="toc-text">wait(), notify(), notifyAll() and other methods</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wait-and-notify-example"><span class="toc-text">wait() and notify() example</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wait-long-timeout-and-notify"><span class="toc-text">wait(long timeout) and notify()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#wait-and-notifyAll"><span class="toc-text">wait() and notifyAll()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-notify-wait-and-other-functions-are-defined-in-Object-instead-of-Thread"><span class="toc-text">Why notify(), wait() and other functions are defined in Object instead of Thread</span></a></li></ol>
    </div>
</div>



<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>




	</div>
	


<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
            

<article class="read-next-card" style="background-image: url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)">
  <header class="read-next-card-header">
    <small class="read-next-card-header-sitetitle">&mdash; Nick Li &mdash;</small>
    <h3 class="read-next-card-header-title">Recent Posts</h3>
  </header>
  <div class="read-next-divider">
    <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24">
      <path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/>
    </svg>
  </div>
  <div class="read-next-card-content">
    <ul>
      
      
      
      <li>
        <a href="/Java-Multithreading-11-AtomicIntegerArray/">Java Multithreading 11: AtomicIntegerArray</a>
      </li>
      
      
      
      <li>
        <a href="/Leetcode-209-Minimum-Size-Subarray-Sum/">Leetcode 209. Minimum Size Subarray Sum</a>
      </li>
      
      
      
      <li>
        <a href="/Java-Multithreading-10-AtomicInteger/">Java Multithreading 10: AtomicInteger</a>
      </li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
  <footer class="read-next-card-footer">
    <a href="/archives">  MORE  → </a>
  </footer>
</article>

            
            
            

<article class="read-next-card" style="background-image: url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)">
    <header class="read-next-card-header tagcloud-card">
        <h3 class="read-next-card-header-title">Categories</h3>
    </header>
    <div class="read-next-card-content">
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Data-Structure-and-Algorithms/">Data Structure and Algorithms</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/how-to-guide/">how-to-guide</a></li></ul>
    </div>
</article>


            
            
            

<article class="read-next-card" style="background-image: url(https://i.loli.net/2017/11/26/5a19c56faa29f.jpg)">
	<header class="read-next-card-header tagcloud-card">
		<h3 class="read-next-card-header-title">Tag Cloud</h3>
	</header>
	<div class="read-next-card-content-ext">
		<a href="/tags/Cron-Expression/" style="font-size: 14px;">Cron Expression</a> <a href="/tags/Intellij/" style="font-size: 14px;">Intellij</a> <a href="/tags/Jackson/" style="font-size: 14px;">Jackson</a> <a href="/tags/Java-8-New-Features/" style="font-size: 14.91px;">Java 8 New Features</a> <a href="/tags/Java-Collections/" style="font-size: 16.73px;">Java Collections</a> <a href="/tags/Leetcode-Array/" style="font-size: 24px;">Leetcode - Array</a> <a href="/tags/Leetcode-Backtracking/" style="font-size: 23.09px;">Leetcode - Backtracking</a> <a href="/tags/Leetcode-Binary-Search/" style="font-size: 18.55px;">Leetcode - Binary Search</a> <a href="/tags/Leetcode-Bit-Manipulation/" style="font-size: 14px;">Leetcode - Bit Manipulation</a> <a href="/tags/Leetcode-Breadth-First-Search/" style="font-size: 15.82px;">Leetcode - Breadth First Search</a> <a href="/tags/Leetcode-Depth-First-Search/" style="font-size: 20.36px;">Leetcode - Depth First Search</a> <a href="/tags/Leetcode-Divde-and-Conquer/" style="font-size: 14px;">Leetcode - Divde and Conquer</a> <a href="/tags/Leetcode-Dynamic-Programming/" style="font-size: 22.18px;">Leetcode - Dynamic Programming</a> <a href="/tags/Leetcode-Graph/" style="font-size: 14px;">Leetcode - Graph</a> <a href="/tags/Leetcode-Greedy/" style="font-size: 15.82px;">Leetcode - Greedy</a> <a href="/tags/Leetcode-Hash-Table/" style="font-size: 17.64px;">Leetcode - Hash Table</a> <a href="/tags/Leetcode-Linked-List/" style="font-size: 18.55px;">Leetcode - Linked List</a> <a href="/tags/Leetcode-Math/" style="font-size: 14.91px;">Leetcode - Math</a> <a href="/tags/Leetcode-Sliding-Window/" style="font-size: 14px;">Leetcode - Sliding Window</a> <a href="/tags/Leetcode-Sort/" style="font-size: 17.64px;">Leetcode - Sort</a> <a href="/tags/Leetcode-Stack/" style="font-size: 14px;">Leetcode - Stack</a> <a href="/tags/Leetcode-String/" style="font-size: 18.55px;">Leetcode - String</a> <a href="/tags/Leetcode-Topological-Sort/" style="font-size: 14px;">Leetcode - Topological Sort</a> <a href="/tags/Leetcode-Tree/" style="font-size: 19.45px;">Leetcode - Tree</a> <a href="/tags/Leetcode-Two-Pointers/" style="font-size: 22.18px;">Leetcode - Two Pointers</a> <a href="/tags/Leetcode-Union-Find/" style="font-size: 14.91px;">Leetcode - Union Find</a> <a href="/tags/Multithreading/" style="font-size: 21.27px;">Multithreading</a> <a href="/tags/Stream-API/" style="font-size: 14.91px;">Stream API</a> <a href="/tags/hexo/" style="font-size: 14.91px;">hexo</a>
	</div>
</article>

            
        </div>
    </div>
</aside>

	




<div id="search" class="search-overlay">
    <div class="search-form">
        
        <input id="local-search-input" class="search-input" type="text" name="search" placeholder="Search ...">
        <a class="search-overlay-close" href="#"></a>
    </div>
    <div id="local-search-result"></div>
</div>

<footer class="site-footer outer">
	<div class="site-footer-content inner">
		<div class="copyright">
			<a href="/" title="Nick Li">Nick Li &copy; 2020</a>
			
				
			        <span hidden="true" id="/Java-Multithreading-3-Wait-and-notify/" class="leancloud-visitors" data-flag-title="Java Multithreading 3: Wait and notify">
			            <span>阅读量 </span>
			            <span class="leancloud-visitors-count">0</span>
			        </span>
	    		
    		
		</div>
		<nav class="site-footer-nav">
			
			<a href="https://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
			<a href="https://github.com/xzhih/hexo-theme-casper" title="Casper" target="_blank" rel="noopener">Casper</a>
		</nav>
	</div>
</footer>
	


<script>
    if(window.navigator && navigator.serviceWorker) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister()
            }
        })
    }
</script>


<script id="scriptLoad" src="/js/allinone.min.js" async></script>


<script>
    document.getElementById('scriptLoad').addEventListener('load', function () {
        
        
            var bLazy = new Blazy();
        

        
        

        
        
        
            searchFunc("/");
        
        
    })
</script>



<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>




<script id="valineScript" src="//unpkg.com/valine/dist/Valine.min.js" async></script>
<script>
    document.getElementById('valineScript').addEventListener("load", function() {
        new Valine({
            el: '#comment' ,
            verify: false,
            notify: false,
            appId: '3TACGUnsSRuWgqCn3pRpLVwQ-MdYXbMMI',
            appKey: 'JTo5iyjOyGTEXzAwjaTNqcY0',
            placeholder: 'Please leave a comment',
            pageSize: 10,
            avatar: 'mm',
            visitor: true,
            lang: 'en'
        })
    });
</script>





</body>
</html>
